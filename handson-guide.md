# ハンズオン作成ガイド

chapter4のハンズオン作成時のやりとりから抽出した、学習目的と作成時の注意点。
chapter5以降のハンズオン作成の参考にする。

---

## 学習者（私）の特性

### 学びたいこと
- **AIエージェント作りのコア部分**を学びたい
  - LangGraphによるエージェントフロー設計
  - Plan-and-Executeパターン
  - Reflectionによる自己評価
  - サブグラフ、並列実行など
- **不要なもの**: ツール作り、インデックス構築、インフラ構築
  - これらは「学びたいこと」ではないが、動作確認のために必要
  - 最初から用意しておき、ハンズオンでは触れない

### 経験レベル
- LangChain/LangGraph: 未経験
- RAG: 深い理解あり

### 学習目的
- AIエージェント作りの**基礎の理解**を深める
- 理論だけでなく、**手を動かして**理解したい

### 好みの学習スタイル
- **写経スタイル**: ステップごとにコードを自分で書く
- **段階的に機能追加**: 最小構成から始めて、機能を追加していく
- **考えさせるポイント**: ただコードを写すだけでなく、「なぜこうなるか」を考える時間がほしい
- **動作確認しながら進める**: 各Stepで実行して結果を観察したい

---

## ハンズオン作成時の注意点

### 1. ディレクトリ構成

**最終的に元のchapterと同じ構成にする**
- 別ディレクトリ（例：`chapter4-handson/`）で作成
- 最終形は元の`chapter4/`と同じファイル構成
- Stepごとに同じファイルを**発展させていく**形式

```
chapter4-handson/
├── src/
│   ├── agent.py      ← Stepごとに中身が発展
│   ├── configs.py    ← Step1で作成
│   ├── models.py     ← Step3で作成、以降追加
│   ├── prompts.py    ← Step3で作成、以降追加
│   └── tools/        ← Step2で作成
└── ...
```

### 2. 最初から用意するもの（Phase 0）

**インフラ・環境周りは最初から完成版を用意**
- Docker関連（`docker-compose.yml`, `.docker/Dockerfile`）
- `Makefile`
- `pyproject.toml`（依存関係は全部入り）
- `.env.sample`, `.gitignore`, `.python-version`
- `data/`（RAGデータ）
- `src/scripts/`（インデックス構築スクリプト）
- 空の`__init__.py`ファイル

**理由**: 学びたいのはエージェントのコア部分であり、インフラ構築ではない

### 3. テスト用質問の準備

**難易度別に複数パターン用意**

| パターン | 難易度 | 用途 |
|----------|--------|------|
| Q1 | シンプル（1トピック） | 基本動作確認、最小構成の検証 |
| Q2 | 中程度（2トピック・関連あり） | Plan機能の検証 |
| Q3 | 中程度（2トピック・関連なし） | 並列処理の検証 |
| Q4 | 複雑（3トピック以上） | Reflection、サブグラフの検証 |

### 4. 各Stepの構成

```markdown
## Step N: タイトル

### 目標
- このStepで達成すること（箇条書き）

### 概念説明
- 図や簡単な説明で概念を説明

### Think N-1: 考えさせるポイント
> 質問形式で考えさせる
<details>でヒントと回答を隠す

### 実装
- 作成/更新するファイルごとにコードを提示
- コメントで重要なポイントを説明

### 実行してみよう
- 実行コマンド

### Think N-2: 実行結果を見て考える
> 「前のStepとの違いは？」「この実装の限界は？」など

### Step N まとめ
- 学んだことを箇条書き
- 次のステップへの導入
```

### 5. Thinkポイントの種類

1. **事前思考**: コードを書く前に考える
   - 「状態として何を保持すべき？」
   - 「なぜこの機能が必要？」

2. **実行後観察**: 結果を見て考える
   - 「前のStepとの違いは？」
   - 「この実装の限界は？」

3. **仕組みの理解**: コードの動きを理解する
   - 「ループの仕組みを図で描けますか？」
   - 「この関数は何を返している？」

4. **トレードオフ**: 設計判断を考える
   - 「この機能のデメリットは？」
   - 「なぜこの方式を選んだ？」

### 6. 段階的に追加する機能の順序（パターンB）

**「動くものから育てる」アプローチ**

1. **最小エージェント**: 質問→回答だけ
2. **Tool Calling追加**: RAGで検索できるように
3. **Plan追加**: 質問を分解できるように
4. **状態管理改善**: Annotated + operator.add
5. **Reflection追加**: 自己評価とリトライ
6. **並列実行**: パフォーマンス向上
7. **サブグラフ化**: コード整理

**ポイント**: 常に「動くもの」がある状態を維持

### 7. コード提示のコツ

- **差分ではなく全体を提示**: 初心者でも迷わない
- **重要な変更点にはコメント**: `# ← 追加` など
- **実行コマンドを明記**: `uv run python -m src.agent`
- **出力例も見せる**: 何が表示されるか期待値を持てる

---

## chapter5以降への適用

### 事前準備として確認すること
1. そのchapterで**学ぶべきコア部分**は何か？
2. **不要なもの**（インフラ、ツールなど）は何か？
3. どういう**段階**で機能を追加するか？
4. **テスト用の入力**として何を用意するか？

### ハンズオンの骨格
1. Phase 0で**インフラを用意**
2. 最小構成から始めて**段階的に発展**
3. 各Stepに**Thinkポイント**を入れる
4. 最終的に**元のchapterと同じ構成**に到達

---

## 参考：chapter4で作成したファイル

```
chapter4-handson/
├── .docker/Dockerfile
├── .env.sample
├── .gitignore
├── .python-version
├── data/                    # chapter4からコピー
├── docker-compose.yml
├── Makefile
├── pyproject.toml
├── handson.md               # 約2800行
├── test_questions.md        # 4パターンの質問
└── src/
    ├── __init__.py
    ├── scripts/
    │   ├── __init__.py
    │   ├── create_index.py
    │   └── delete_index.py
    └── tools/
        └── __init__.py
```

**handson.md内のStep構成**:
- Step 1: 最小エージェント（LangGraph基本）
- Step 2: Tool Calling追加
- Step 3: Plan追加（Structured Output、ループ）
- Step 4: サブタスク分割改善（Annotated + operator.add）
- Step 5: Reflection追加
- Step 6: 並列実行（Send）
- Step 7: サブグラフ化
